#### 5.1 Solve:

1.

```sql
SELECT DISTINCT S.Sname
FROM Student S, Class C, Enrolled E, Faculty F
WHERE S.snum = E.snum AND E.cname = C.name AND C.fid = F.fid AND F.fname = ‘I.Teach’ 
		AND S.level = ‘JR’
```

2.

```sql
SELECT MAX(S.age)
FROM Student S
WHERE (S.major = ‘History’)
		OR S.snum IN (SELECT E.snum
				FROM Class C, Enrolled E, Faculty F
				WHERE E.cname = C.name AND C.fid = F.fid AND F.fname = ‘I.Teach’ )
```

3.

```sql
SELECT C.name
FROM Class C
WHERE C.room = ‘R128’
		OR C.name IN (SELECT E.cname
					FROM Enrolled E
					GROUP BY E.cname
					HAVING COUNT (*) >= 5)
```

4.

```sql
SELECT DISTINCT S.sname
FROM Student S
WHERE S.snum IN (SELECT E1.snum
				FROM Enrolled E1, Enrolled E2, Class C1, Class C2
				WHERE E1.snum = E2.snum AND E1.cname <> E2.cname AND E1.cname = C1.name 
                 AND E2.cname = C2.name AND C1.meets at = C2.meets at)
```

5.

```sql
SELECT DISTINCT F.fname
FROM Faculty F
WHERE NOT EXISTS (( SELECT *
						FROM Class C )
						EXCEPT
						(SELECT C1.room
						FROM Class C1
						WHERE C1.fid = F.fid ))
```

6.

```sql
SELECT DISTINCT F.fname
FROM Faculty F
WHERE 5 > (SELECT COUNT (E.snum)
			FROM Class C, Enrolled E
			WHERE C.name = E.cname AND C.fid = F.fid)
```

7.

```sql
SELECT S.level, AVG(S.age)
FROM Student S
GROUP BY S.level
```

8.

```sql
SELECT S.level, AVG(S.age)
FROM Student S
WHERE S.level <> ‘JR’
GROUP BY S.level
```

9.

```sql
SELECT F.fname, COUNT(*) AS CourseCount
FROM Faculty F, Class C
WHERE F.fid = C.fid
GROUP BY F.fid, F.fname
HAVING EVERY ( C.room = ‘R128’ )
```

10.

```sql
SELECT DISTINCT S.sname
FROM Student S
WHERE S.snum IN (SELECT E.snum
				FROM Enrolled E
				GROUP BY E.snum 
                  HAVING COUNT (*) >= ALL (SELECT COUNT (*)
										FROM Enrolled E2
										GROUP BY E2.snum ))
```

11.

```sql
SELECT DISTINCT S.sname
FROM Student S
WHERE S.snum NOT IN (SELECT E.snum
					FROM Enrolled E )
```

12.

```sql
SELECT S.age, S.level
FROM Student S
GROUP BY S.age, S.level,
HAVING S.level IN (SELECT S1.level
				FROM Student S1
				WHERE S1.age = S.age
				GROUP BY S1.level, S1.age
				HAVING COUNT (*) >= ALL (SELECT COUNT (*)
										FROM Student S2
										WHERE s1.age = S2.age
										GROUP BY S2.level, S2.age))
```

#### 5.2 Solve:

1.

```sql
SELECT DISTINCT P.pname
FROM Parts P, Catalog C
WHERE P.pid = C.pid
```

2.

```sql
SELECT S.sname
FROM Suppliers S
WHERE NOT EXISTS (( SELECT P.pid
					FROM Parts P )
					EXCEPT
					( SELECT C.pid
					FROM Catalog C
					WHERE C.sid = S.sid ))
```

3.

```sql
SELECT S.sname
FROM Suppliers S
WHERE NOT EXISTS (( SELECT P.pid
					FROM Parts P
					WHERE P.color = ‘Red’ )
					EXCEPT
					( SELECT C.pid
					FROM Catalog C, Parts P
					WHERE C.sid = S.sid AND C.pid = P.pid AND P.color = ‘Red’ ))
```

4.

```sql
SELECT P.pname
FROM Parts P, Catalog C, Suppliers S
WHERE P.pid = C.pid AND C.sid = S.sid AND S.sname = ‘Acme Widget Suppliers’ 
		AND NOT EXISTS ( SELECT *
						FROM Catalog C1, Suppliers S1
						WHERE P.pid = C1.pid AND C1.sid = S1.sid 
                        	AND S1.sname <> ‘Acme Widget Suppliers’ )
```

5.

```sql
SELECT DISTINCT C.sid
FROM Catalog C
WHERE C.cost > ( SELECT AVG (C1.cost)
				FROM Catalog C1
				WHERE C1.pid = C.pid )
```

6.

```sql
SELECT P.pid, S.sname
FROM Parts P, Suppliers S, Catalog C
WHERE C.pid = P.pid AND C.sid = S.sid AND C.cost = (SELECT MAX (C1.cost)
												FROM Catalog C1
												WHERE C1.pid = P.pid)
```

7.

```sql
SELECT DISTINCT C.sid
FROM Catalog C
WHERE NOT EXISTS ( SELECT *
					FROM Parts P
					WHERE P.pid = C.pid AND P.color <> ‘Red’ )
```

8.

```sql
SELECT DISTINCT C.sid
FROM Catalog C, Parts P
WHERE C.pid = P.pid AND P.color = ‘Red’
INTERSECT
SELECT DISTINCT C1.sid
FROM Catalog C1, Parts P1
WHERE C1.pid = P1.pid AND P1.color = ‘Green’
```

9.

```sql
SELECT DISTINCT C.sid
FROM Catalog C, Parts P
WHERE C.pid = P.pid AND P.color = ‘Red’
UNION
SELECT DISTINCT C1.sid
FROM Catalog C1, Parts P1
WHERE C1.pid = P1.pid AND P1.color = ‘Green’
```

10.

```sql
SELECT S.sname, COUNT(*) as PartCount
FROM Suppliers S, Parts P, Catalog C
WHERE P.pid = C.pid AND C.sid = S.sid
GROUP BY S.sname, S.sid
HAVING EVERY (P.color=’Green’)
```

11.

```sql
SELECT S.sname, MAX(C.cost) as MaxCost
FROM Suppliers S, Parts P, Catalog C
WHERE P.pid = C.pid AND C.sid = S.sid
GROUP BY S.sname, S.sid
HAVING ANY ( P.color=’green’ ) AND ANY ( P.color = ’red’ )
```

#### 5.3 Solve:

1.

```sql
SELECT DISTINCT A.aname
FROM Aircraft A
WHERE A.Aid IN (SELECT C.aid
			FROM Certified C, Employees E
			WHERE C.eid = E.eid AND
			NOT EXISTS ( SELECT *
						FROM Employees E1
						WHERE E1.eid = E.eid AND E1.salary < 80000 ))
```

2.

```sql
SELECT C.eid, MAX (A.cruisingrange)
FROM Certified C, Aircraft A
WHERE C.aid = A.aid
GROUP BY C.eid
HAVING COUNT (*) > 3
```

3.

```sql
SELECT DISTINCT E.ename
FROM Employees E
WHERE E.salary < ( SELECT MIN (F.price)
					FROM Flights F
					WHERE F.from = ‘Los Angeles’ AND F.to = ‘Honolulu’ )
```

4.

```sql
SELECT Temp.name, Temp.AvgSalary
FROM ( SELECT A.aid, A.aname AS name, AVG (E.salary) AS AvgSalary
		FROM Aircraft A, Certified C, Employees E
		WHERE A.aid = C.aid AND C.eid = E.eid AND A.cruisingrange > 1000
		GROUP BY A.aid, A.aname ) AS Temp
```

5.

```sql
SELECT DISTINCT E.ename
FROM Employees E, Certified C, Aircraft A
WHERE E.eid = C.eid AND C.aid = A.aid AND A.aname LIKE ‘Boeing%’
```

6.

```sql
SELECT A.aid
FROM Aircraft A
WHERE A.cruisingrange > ( SELECT MIN (F.distance)
						FROM Flights F
						WHERE F.from = ‘Los Angeles’ AND F.to = ‘Chicago’ )
```

7.

```sql
SELECT DISTINCT F.from, F.to
FROM Flights F
WHERE NOT EXISTS ( SELECT *
					FROM Employees E
					WHERE E.salary > 100000
					AND
					NOT EXISTS (SELECT *
								FROM Aircraft A, Certified C
								WHERE A.cruisingrange > F.distance 
								AND E.eid = C.eid AND A.aid = C.aid) )
```

8.

```sql
SELECT DISTINCT E.ename
FROM Employees E
WHERE E.eid IN ( ( SELECT C.eid
					FROM Certified C
					WHERE EXISTS ( SELECT A.aid
									FROM Aircraft A
									WHERE A.aid = C.aid AND A.cruisingrange > 3000 )
									AND
									NOT EXISTS ( SELECT A1.aid
												FROM Aircraft A1
												WHERE A1.aid = C.aid 
                                                	AND A1.aname LIKE ‘Boeing%’ ))
```

9.

```sql
SELECT F.departs
FROM Flights F
WHERE F.flno IN ( ( SELECT F0.flno
                   	  FROM Flights F0
					WHERE F0.from = ‘Madison’ AND F0.to = ‘New York’ 
                      AND F0.arrives < ‘18:00’ )
					UNION
					( SELECT F0.flno
						FROM Flights F0, Flights F1
						WHERE F0.from = ‘Madison’ AND F0.to <> ‘New York’
						AND F0.to = F1.from AND F1.to = ‘New York’ 
                     	  AND F1.departs > F0.arrives AND F1.arrives < ‘18:00’ )
					UNION
					( SELECT F0.flno
						FROM Flights F0, Flights F1, Flights F2
						WHERE F0.from = ‘Madison’ AND F0.to = F1.from AND F1.to = F2.from
							AND F2.to = ‘New York’ AND F0.to <> ‘New York’
							AND F1.to <> ‘New York’ AND F1.departs > F0.arrives
							AND F2.departs > F1.arrives AND F2.arrives < ‘18:00’ ))
```

10.

```sql
SELECT Temp1.avg - Temp2.avg
FROM (SELECT AVG (E.salary) AS avg
		FROM Employees E
		WHERE E.eid IN (SELECT DISTINCT C.eid
						FROM Certified C )) AS Temp1,
						(SELECT AVG (E1.salary) AS avg
							FROM Employees E1 ) AS Temp2
```

11.

```sql
SELECT E.ename, E.salary
FROM Employees E
WHERE E.eid NOT IN ( SELECT DISTINCT C.eid
					FROM Certified C )
					AND E.salary > ( SELECT AVG (E1.salary)
									FROM Employees E1
									WHERE E1.eid IN
									( SELECT DISTINCT C1.eid
									FROM Certified C1 ) )
```

12.

```sql
SELECT E.ename
FROM Employees E, Certified C, Aircraft A
WHERE C.aid = A.aid AND E.eid = C.eid
GROUP BY E.eid, E.ename
HAVING EVERY (A.cruisingrange > 1000)
```

13.

```sql
SELECT E.ename
FROM Employees E, Certified C, Aircraft A
WHERE C.aid = A.aid AND E.eid = C.eid
GROUP BY E.eid, E.ename
HAVING EVERY (A.cruisingrange > 1000) AND COUNT (*) > 1
```

14.

```sql
SELECT E.ename
FROM Employees E, Certified C, Aircraft A
WHERE C.aid = A.aid AND E.eid = C.eid
GROUP BY E.eid, E.ename
HAVING EVERY (A.cruisingrange > 1000) AND ANY (A.aname = ’Boeing’)
```

